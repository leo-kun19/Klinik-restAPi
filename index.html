<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinic Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-5">
        <h1 class="text-3xl font-bold text-center text-blue-600 mb-8">Clinic Management System</h1>

        <div>
            <h3 class="text-2xl font-semibold mb-4">Patients</h3>
            <form id="patientForm" class="flex flex-wrap gap-4 mb-6">
                <input type="text" id="name" class="flex-1 border border-gray-300 rounded p-2" placeholder="Name" required>
                <input type="number" id="age" class="w-20 border border-gray-300 rounded p-2" placeholder="Age" required>
                <select id="gender" class="w-36 border border-gray-300 rounded p-2" required>
                    <option value="" disabled selected>Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>
                <button type="submit" class="bg-blue-500 text-white rounded px-4 py-2">Add Patient</button>
            </form>
            <ul id="patientList" class="bg-white rounded shadow p-4 space-y-2"></ul>
        </div>

        <div class="mt-10">
            <h3 class="text-2xl font-semibold mb-4">Appointments</h3>
            <form id="appointmentForm" class="flex flex-wrap gap-4 mb-6">
                <select id="patientId" class="flex-1 border border-gray-300 rounded p-2" required>
                    <option value="" disabled selected>Select Patient</option>
                </select>
                <input type="text" id="doctorName" class="flex-1 border border-gray-300 rounded p-2" placeholder="Doctor Name" required>
                <input type="datetime-local" id="appointmentDate" class="w-60 border border-gray-300 rounded p-2" required>
                <button type="submit" class="bg-blue-500 text-white rounded px-4 py-2">Add</button>
            </form>
            <ul id="appointmentList" class="bg-white rounded shadow p-4 space-y-2"></ul>
        </div>
    </div>

    <script>
        const API_URL = "http://localhost:8000"; // Change this if your API runs elsewhere

        // Fetch and display patients
        const fetchPatients = async () => {
            const response = await fetch(`${API_URL}/patients/`);
            const patients = await response.json();
            const patientList = document.getElementById("patientList");
            const patientIdSelect = document.getElementById("patientId");
            patientList.innerHTML = "";
            patientIdSelect.innerHTML = '<option value="" disabled selected>Select Patient</option>';

            patients.forEach(patient => {
                const li = document.createElement("li");
                li.className = "border border-gray-300 p-3 rounded shadow-sm";
                li.textContent = `${patient.name} (${patient.age} years old, ${patient.gender})`;
                patientList.appendChild(li);

                const option = document.createElement("option");
                option.value = patient.id;
                option.textContent = patient.name;
                patientIdSelect.appendChild(option);
            });
        };

        // Add patient
        document.getElementById("patientForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const name = document.getElementById("name").value;
            const age = document.getElementById("age").value;
            const gender = document.getElementById("gender").value;

            await fetch(`${API_URL}/patients/`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, age, gender })
            });
            fetchPatients();
            e.target.reset();
        });

        // Fetch and display appointments
        const fetchAppointments = async () => {
            const response = await fetch(`${API_URL}/appointments/`);
            const appointments = await response.json();
            const appointmentList = document.getElementById("appointmentList");
            appointmentList.innerHTML = "";

            appointments.forEach(appointment => {
                const li = document.createElement("li");
                li.className = "border border-gray-300 p-3 rounded shadow-sm";
                li.textContent = `Patient: ${appointment.patient.name}, Doctor: ${appointment.doctor_name}, Date: ${new Date(appointment.appointment_date).toLocaleString()}`;
                appointmentList.appendChild(li);
            });
        };

        // Add appointment
        document.getElementById("appointmentForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const patientId = document.getElementById("patientId").value;
            const doctorName = document.getElementById("doctorName").value;
            const appointmentDate = document.getElementById("appointmentDate").value;

            await fetch(`${API_URL}/appointments/`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ patient_id: patientId, doctor_name: doctorName, appointment_date: appointmentDate })
            });
            fetchAppointments();
            e.target.reset();
        });

        // Initial fetch
        fetchPatients();
        fetchAppointments();
    </script>
</body>
</html>
